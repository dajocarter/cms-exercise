<!DOCTYPE html>
<html>

<head>
  <link href="css/main.css" rel="stylesheet" />
</head>

<body>
  <div id="app">
    <header>
      <div class="logo">
        <img class="logo__image" src="img/giphy_logo_with_text.png" />
      </div>
    </header>
    <div id="container">
      <ul id="gifs"></ul>
    </div>
    <footer>
      <form>
        <label for="query" class="screen-reader-text">Search GIFs via GIPHY</label>
        <input id="search__input" type="text" name="query" placeholder="Search GIFs via GIPHY" />
        <input id="search__submit" type="submit" value="" />
      </form>
    </footer>
  </div>

  <script type="text/javascript">
    // Get params from plugin init
    const args = top.tinymce.activeEditor.windowManager.getParams();
    // Save jQuery to $ variable
    const $ = args['jquery'];
    // Get iframe <body> to set a context for jQuery
    // bc it will use the background parent window as a default
    // so need to set context to the popup
    const context = document.getElementsByTagName('body')[0];
    // Now just include context as 2nd argument to every jQuery selector
    $('footer form', context).submit(function (evt) {
      evt.preventDefault();

      const query = $('input[name="query"]', context).val();
      // Inject iframe into the editor and close the popup
      const iframe = `<iframe src="https://giphy.com/embed/${gif_id}" width="480" height="406" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>`;
      args.editor.selection.setContent(iframe);
      args.editor.windowManager.close();
    });
  </script>
</body>

</html>